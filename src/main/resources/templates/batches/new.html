<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<!--<head>-->
<!--    &lt;!&ndash; Required meta tags &ndash;&gt;-->
<!--    <meta charset="utf-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->

<!--    &lt;!&ndash; Bootstrap CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">-->
<!--</head>-->
<body>

    <!--NAVBAR ADDING-->
    <div th:insert="fragments/header :: navbar"></div>

    <form th:object="${batch}" method="post" th:action="${'/batches/new'}">

        <!--INPUT FIELDS-->
        <div>
            <div>
                <div style="padding: 10px">
                    <label>Name:</label>
                    <input type="text" class="form-control" th:field="*{name}"/>
                    <td th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Name Error</td>
                </div>
                <div style="padding: 10px">
                    <label>Freezer:</label>
                    <select th:field="*{freezer.name}">
                        <option th:value="0" text="Please Select" disabled selected></option>
                        <option th:each="freez : ${freezers}" th:value="${freez}" th:text="${freez}"></option>
                    </select>
                    <td th:if="${#fields.hasErrors('freezer')}" th:errors="*{freezer}">Name Error</td>
                </div>
                <div style="padding: 10px">
                    <label>Style:</label>
                    <input type="text" class="form-control" th:field="*{style}"/>
                    <td th:if="${#fields.hasErrors('style')}" th:errors="*{style}">Name Error</td>
                </div>
                <div style="padding: 10px">
                    <label>BatchType:</label>
                    <select name="batchType">
                        <option th:value="0" text="Please Select" disabled selected></option>
                        <option th:each="typeOpt : ${T(com.agh.database.brewingdatabaseapp.model.BatchType).values()}"
                                th:value="${typeOpt}" th:text="${typeOpt}"></option>
                    </select>
                    <td th:if="${#fields.hasErrors('batchType')}" th:errors="*{batchType}">Name Error</td>
                </div>
                <div style="padding: 10px">
                    <label>BrewedDate:</label>
                    <input type="date" class="form-control" th:field="*{brewedDate}"/>
                    <td th:if="${#fields.hasErrors('brewedDate')}" th:errors="*{brewedDate}">Name Error</td>
                </div>
                <div style="padding: 10px">
                    <label>BottledDate:</label>
                    <input type="date" class="form-control" th:field="*{bottledDate}"/>
                    <td th:if="${#fields.hasErrors('bottledDate')}" th:errors="*{bottledDate}">Name Error</td>
                </div>
            </div>

            <div>
                <table id="batches" class="table table-striped">
                    <thead>
                    <tr>
                        <th style="width: 200px;">Ingredient name</th>
                        <th style="width: 200px;">Amount</th>
                        <th style="width: 200px;">Time</th>
                        <th style="width: 200px;">Technique</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="batchIngredient, itemStat : *{batchIngredients}">
                        <td th:text="*{batchIngredients[__${itemStat.index}__].ingredientName}"/>
                        <td hidden><input th:field="*{batchIngredients[__${itemStat.index}__].ingredientName}" /></td>
                        <td><input th:field="*{batchIngredients[__${itemStat.index}__].amount}" /></td>
                        <td><input th:field="*{batchIngredients[__${itemStat.index}__].time}" /></td>
                        <td>
                            <select th:field="*{batchIngredients[__${itemStat.index}__].techniqueType}">
                                <option th:value="0" text="Please Select" disabled selected></option>
                                <option th:each="typeOpt : ${T(com.agh.database.brewingdatabaseapp.model.TechniqueType).values()}"
                                        th:value="${typeOpt}" th:text="${typeOpt}"></option>
                            </select>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!--LIST OF MASHES-->
            <div id="mashList">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 200px;">Step</th>
                            <th style="width: 200px;">Temperature</th>
                            <th style="width: 200px;">Duration Mins</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr class="row item" th:each="mash, status : ${batch.mashes}">
                            <td class="col form-group" style="width: 200px;" th:text="${status.count}"/>
                            <td class="col form-group">
                                <input th:field="*{mashes[__${status.index}__].temp}" type="text" class="form-control">
                            </td>
                            <td class="col form-group">
                                <input th:field="*{mashes[__${status.index}__].durationMins}" type="text" class="form-control">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!--ADD NEW ROW BUTTON-->
        <div class="row">
            <div class="col">
                <button type="button" class="btn btn-success" onclick="addRow()">Next step</button>
            </div>
        </div>

        <!--SUBMIT FORM BUTTON-->
        <div>
            <div style="padding: 10px">
                <button type="submit">Add Batch</button>
            </div>
        </div>

    </form>

    <script th:inline="javascript">

        let addRow = function () {
            let listName = 'mashes'; //list name in Catalog.class
            let fieldsNames = ['durationMins', 'temp']; //field names from Movie.class
            let rowIndex = document.querySelectorAll('.item').length; //we can add mock class to each movie-row

            let row = document.createElement('tr');
            row.classList.add('row', 'item');


            let col = document.createElement('td');
            col.classList.add('col', 'form-group');
            col.style.width = "200px";

            col.innerText = (rowIndex + 1).toString();
            row.appendChild(col);

            fieldsNames.forEach((fieldName) => {
                let col = document.createElement('td');
                col.classList.add('col', 'form-group');
                col.style.width = "200px";

                let input = document.createElement('input');
                input.type = 'text';
                input.classList.add('form-control');
                input.id = listName + rowIndex + '.' + fieldName;
                input.setAttribute('name', listName + '[' + rowIndex + '].' + fieldName);

                col.appendChild(input);
                row.appendChild(col);
            });

            document.getElementById('mashList').appendChild(row);
        };

    </script>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<!--<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>-->
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>-->
</body>
</html>